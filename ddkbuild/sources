TARGETNAME=ntobjx
!if $(386)
TARGETNAME=$(TARGETNAME)32
!elseif $(AMD64)
TARGETNAME=$(TARGETNAME)64
!endif
TARGETNAME=$(TARGETNAME)_wdk

TARGETPATH=obj
TARGETTYPE=PROGRAM
UNICODE=1
BUILD_ALLOW_ALL_WARNINGS=1
UMTYPE=windows
USE_MSVCRT=1
USE_STATIC_ATL=1
ATL_VER=70
USE_NATIVE_EH=1
USE_RTTI=1
# Not tested on Itanium, use at your own risk ... and if you do it, report back, please
DDK_BLOCK_ON_IA64=1

# Use additional include file
#NTTARGETFILES=makefile.inc

C_DEFINES=$(C_DEFINES) /DDDKBUILD

!IF defined(UNICODE) && $(UNICODE)
UMENTRY=wwinmain
C_DEFINES=$(C_DEFINES) /DUNICODE /D_UNICODE
!ELSE
UMENTRY=winmain
C_DEFINES=$(C_DEFINES) /DMBCS /D_MBCS
!ENDIF

INCLUDES=$(DDK_INC_PATH);$(CRT_INC_PATH);$(SDK_INC_PATH);..;..\wtl\Include;..\pugixml;..\util;.

# Set this to 0 in order to build without AclUI
# NB: given the solution in this folder is for VS8 you should not need
# to disable this, but if you do now you know how.
WITHACLUI=1

TARGETLIBS=\
            $(SDK_LIB_PATH)\kernel32.lib \
            $(SDK_LIB_PATH)\user32.lib \
            $(SDK_LIB_PATH)\comctl32.lib \
            $(SDK_LIB_PATH)\comdlg32.lib \
            $(SDK_LIB_PATH)\ole32.lib \
            $(SDK_LIB_PATH)\oleaut32.lib \
            $(SDK_LIB_PATH)\shell32.lib \
            $(SDK_LIB_PATH)\userenv.lib \
            $(SDK_LIB_PATH)\version.lib \
            $(SDK_LIB_PATH)\ntdll.lib

SOURCES=ntobjx.cpp \
        reslang.cpp \
        ddkbuild.rc

!IF $(WITHACLUI)
! IF !defined(VS80COMNTOOLS)
!  MESSAGE VS80COMNTOOLS _must_ be defined and point to the VS8 installation folder
! ENDIF
C_DEFINES=$(C_DEFINES) /DFEATURE_OBJECT_SECURITY=1
# Copy the AclUi.h from the VS8 toolchain
! IF !exist($(OBJ_PATH)\$O\AclUi.h)
!  MESSAGE Copying AclUi.h from $(VS80COMNTOOLS)..\..\VC\PlatformSDK\Include
!  IF [-xcopy /f /y "$(VS80COMNTOOLS)..\..\VC\PlatformSDK\Include\AclUi.h" $(OBJ_PATH)\$O\]
!   MESSAGE Copied AclUi.h
!  ENDIF
! ENDIF
# Copy the AclApi.h from the VS8 toolchain
! IF !exist($(OBJ_PATH)\$O\AclApi.h)
!  MESSAGE Copying AclApi.h from $(VS80COMNTOOLS)..\..\VC\PlatformSDK\Include
!  IF [-xcopy /f /y "$(VS80COMNTOOLS)\..\VC\PlatformSDK\Include\AclApi.h" $(OBJ_PATH)\$O\]
!   MESSAGE Copied AclApi.h
!  ENDIF
! ENDIF
# Copy the AclUi.lib for x64 from the VS8 toolchain
! IF "$(_BUILDARCH)"=="AMD64"
!  IF !exist($(OBJ_PATH)\$O\aclui.lib)
!   IF [-xcopy /f /y "$(VS80COMNTOOLS)..\..\VC\PlatformSDK\Lib\AMD64\aclui.lib" $(OBJ_PATH)\$O\]
!   ENDIF
!  ENDIF
! ENDIF
# Copy the AclUi.lib for x86 from the VS8 toolchain
! IF "$(_BUILDARCH)"=="x86"
!  IF !exist($(OBJ_PATH)\$O\aclui.lib)
!   IF [-xcopy /f /y "$(VS80COMNTOOLS)..\..\VC\PlatformSDK\Lib\aclui.lib" $(OBJ_PATH)\$O\]
!   ENDIF
!  ENDIF
! ENDIF
INCLUDES=$(OBJ_PATH)\$O;$(INCLUDES)
TARGETLIBS=$(TARGETLIBS) $(SDK_LIB_PATH)\uuid.lib $(OBJ_PATH)\$O\aclui.lib
!ENDIF
